{"componentChunkName":"component---src-templates-blog-post-js","path":"/android/viewmodel/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"孙某 Blog"}},"markdownRemark":{"id":"f2d84e9f-cd91-5741-a912-b0678ce2abde","excerpt":"ViewModel是Android Jetpack的重要组成部分，加上LiveData还可以自己更新数据，业务数据相关的逻辑应该都放到这里。   直接上代码，例子实现数据初始化显示，点击变更按钮后，数据自己更新。 Layout: 两个TextView，一个Button User数据： ViewModel…","html":"<p><a href=\"https://developer.android.google.cn/topic/libraries/architecture/viewmodel\">ViewModel</a>是Android Jetpack的重要组成部分，加上LiveData还可以自己更新数据，业务数据相关的逻辑应该都放到这里。  </p>\n<p>直接上代码，例子实现数据初始化显示，点击变更按钮后，数据自己更新。<br>\nLayout: 两个TextView，一个Button</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/textFirst&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;19dp&quot;\n        android:text=&quot;&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/textLast&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;19dp&quot;\n        android:text=&quot;&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintVertical_bias=&quot;0.26&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/button&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;@string/button&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@+id/textFirst&quot;\n        android:onClick=&quot;changeData&quot;\n        /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</code></pre></div>\n<p>User数据：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">public class User {\n    public String getFirstName() {\n        return firstName;\n    }\n\n    public void setFirstName(String firstName) {\n        this.firstName = firstName;\n    }\n\n    public String getLastName() {\n        return lastName;\n    }\n\n    public void setLastName(String lastName) {\n        this.lastName = lastName;\n    }\n\n    private String firstName;\n    private String lastName;\n    public User(String firstName, String lastName) {\n        this.firstName = firstName;\n        this.lastName = lastName;\n    }\n}</code></pre></div>\n<p>ViewModel: 存储数据User，提供修改数据接口  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">public class MyViewModel extends ViewModel {\n    private MutableLiveData&lt;List&lt;User&gt;&gt; users;\n    User hello = new User(&quot;hello&quot;, &quot;world&quot;);\n    User nihao = new User(&quot;ni&quot;, &quot;hao&quot;);\n    List&lt;User&gt; userList = new ArrayList&lt;User&gt;();\n\n    public LiveData&lt;List&lt;User&gt;&gt; getUsers() {\n        if (users == null) {\n            users = new MutableLiveData&lt;List&lt;User&gt;&gt;();\n            loadUsers();\n        }\n        return users;\n    }\n\n    private void loadUsers() {\n        userList.add(hello);\n        users.setValue(userList);\n    }\n\n    public void changeData() {\n        userList.set(0, nihao);\n        users.setValue(userList);  //会通知观察者数据的变化\n    }\n}</code></pre></div>\n<p>Activity：用了view binding，注册数据事件，有数据更新时，自己更新UI  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">public class MainActivity extends AppCompatActivity {\n    private ActivityMainBinding mainBinding;\n    private MyViewModel viewModel;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mainBinding = ActivityMainBinding.inflate(LayoutInflater.from(this));\n        setContentView(mainBinding.getRoot());\n        viewModel = new ViewModelProvider(this).get(MyViewModel.class);\n        viewModel.getUsers().observe(this, users -&gt; {\n            mainBinding.textFirst.setText(users.get(0).getFirstName());\n            mainBinding.textLast.setText(users.get(0).getLastName());\n        });\n    }\n\n    public void changeData(View view) {\n        viewModel.changeData();\n    }\n}</code></pre></div>","frontmatter":{"title":"Android ViewModel 例子","tags":["Android","ViewModel","LiveData"],"date":"March 11, 2020","description":"android viewmodel  小例子，通过例子学习ViewMode+LiveData "}}},"pageContext":{"slug":"/android/viewmodel/","previous":{"fields":{"slug":"/android/lifecycle-22/"},"frontmatter":{"title":"弃用 ViewModelProviders.of()，lifecycle2.2变化","tags":["android","lifecycle"]}},"next":{"fields":{"slug":"/javascript/javascript-convert/"},"frontmatter":{"title":"javascript 常用类型转换","tags":["javascript"]}}}}}