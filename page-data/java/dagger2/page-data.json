{"componentChunkName":"component---src-templates-blog-post-js","path":"/java/dagger2/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"孙某 Blog"}},"markdownRemark":{"id":"2f4c49a1-1706-58dc-a502-02b364bf8c96","excerpt":"依赖注入是设计模式基础原则之一，原则是上层模块不依赖于下层模块，而是依赖于一套抽象接口，上层模块调用接口，下层模块实现接口。 举一个google官网上的例子。 \n汽车都有一个发动机，我们有3种方法去得到发动机这个对象： 汽车自己实例化发动机。 用其它方法获得，比如从修理厂的getEngine…","html":"<p>依赖注入是设计模式基础原则之一，原则是上层模块不依赖于下层模块，而是依赖于一套抽象接口，上层模块调用接口，下层模块实现接口。<br>\n举一个google官网上的例子。\n汽车都有一个发动机，我们有3种方法去得到发动机这个对象：</p>\n<ol>\n<li>\n<p>汽车自己实例化发动机。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">Engine</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    engine<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    car<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>用其它方法获得，比如从修理厂的getEngine方法获得一个。</li>\n<li>\n<p>发动机作为一个参数，把这个参数传到汽车的类里。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Engine</span> engine<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Engine</span> engine<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>engine <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    engine<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Engine</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    car<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>第3种的实现就是依赖注入，依赖注入的好处：</p>\n</li>\n<li>Car的重用，如果有另外的发动机，可以直接利用Car中的方法。</li>\n<li>\n<p>更容易对Car类的测试。<br>\n上面的注入方式，是手动注入的方式。下面我们来介绍一下通过Dagger来实现DI。  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token punctuation\">{</span>\n＠<span class=\"token class-name\">Inject</span>\n<span class=\"token class-name\">Engine</span> engine<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">DaggerCarComponent</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    engine<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Engine</span> <span class=\"token punctuation\">{</span>\n<span class=\"token annotation punctuation\">@Inject</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Engine, start!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CarComponent</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Car</span> car<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    car<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>可以和上面的代码比较一下，只是通过注释来完成setEngine的过程，Dagger还会生成3个辅助类，如下图：<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 447px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e5302d4242e987bc2c465fd5146efc7/a2d48/dagger-generated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.12751677852349%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB9UlEQVQ4y5WTaW7bMBCFfazWkiVSGymJ4qLFiWwnhYEg97/B63Biqw3ituiPhzdc5uMMKe1sJzDZEj98iXXusIwa3hSI866Xm/9Lcd9oK+xiMHuFd3fA5Wjwep7wNLX/BfsCnFyD91HiujqcjpahS1APgX86ZAPGwcBVNnhzGZ4JeFoMLxp9wNBmLKOzv17DbxXeNtC9XUJFlRY4nWe8rB4vpxEX8vOzZ4+HDq2AZcBdgj0WFSLQ06LvBT2EpNYrvE0lrlONlassee6uQIe6uLcXm3O+kTyOe3Z1LdDUkiRQkVstsY4G0zJi6BuopuB11UiOlSrYtSrZ7/l1JdBqAu4ziX0mwH4QSPMClQkYzleE+QjVGdRtj1r3qFTHKpsWslLIi5pzYu538kwSMM0lPiRwj5MkxcEdUXQDaqVhrEdvHVpj0Q8Oig5IqIioLYdiUTBQfAGmWY6MgF2YEcaZQAMrQm2gq3ABsqwfA++tfjtQ2WnOpe/JU79C+wVhWqB7i27wrNhqbC3J5dbup5ZVHS+zwEzfmTMNuraCqnO0QwdrW3ir+XHcoFi6iY+Q04MIiiWPo0dO3xGwo1cdA/1yrsTpySO4ljYTkKRjIkk3H87zigpQ8qZfcQSbCMyp785NMOMRxo3byyWZfKhPX8VNye3aMmL9BMd2AlgZN50KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"生成类\"\n        title=\"生成类\"\n        src=\"/static/4e5302d4242e987bc2c465fd5146efc7/a2d48/dagger-generated.png\"\n        srcset=\"/static/4e5302d4242e987bc2c465fd5146efc7/12f09/dagger-generated.png 148w,\n/static/4e5302d4242e987bc2c465fd5146efc7/e4a3f/dagger-generated.png 295w,\n/static/4e5302d4242e987bc2c465fd5146efc7/a2d48/dagger-generated.png 447w\"\n        sizes=\"(max-width: 447px) 100vw, 447px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br>\n如果Engine类不可以修改，无法在构造函数在注释。我们就需要Module的概念。@Provides提供需要的对象。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Module</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EngineModule</span> <span class=\"token punctuation\">{</span>\n<span class=\"token annotation punctuation\">@Provides</span>\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">Engine</span> <span class=\"token function\">provideEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>其它的代码不变，Engine类的@Inject注释就不用了。</p>\n</li>\n</ol>","frontmatter":{"title":"dagger2的使用","tags":["java","dagger2","di"],"date":"March 21, 2020","description":"使用Dagger2实现依赖注入"}}},"pageContext":{"slug":"/java/dagger2/","previous":{"fields":{"slug":"/java/rxjava/"},"frontmatter":{"title":"RxJava, Retrofit, LiveData 简单例子","tags":["java","rxjava","retrofit","livedata"]}},"next":{"fields":{"slug":"/design/material-design/"},"frontmatter":{"title":"Material Design概述","tags":["Material Design"]}}}}}